
<!DOCTYPE html>
<html lang="zh-CN">
    <!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  
    <link rel="icon" href="/blog/img/favicon.ico">
  
  
      <meta name="author" content="Shen Jiamin">
  
  
  
  
  
    <link rel="alternate" href="/blog/atom.xml " title="TaraBlog" type="application/atom+xml">
  
  
  <title>OAuth 2.0 | TaraBlog</title>

  

  

  


  
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&amp;family=Noto+Serif+SC:wght@400;500;700&amp;display=swap"  media="print" onload="this.media='all'">
  

  
    
      <link rel="stylesheet" href="/blog/css/style.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css">
    
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.0.3/styles/github.min.css">
  

<meta name="generator" content="Hexo 4.2.1"></head>
</html>

    


<header class="header">
    <div class="title animated fadeInDown">
    <div class="title">
        <a href="/blog/" class="logo">TaraBlog</a>
    </div>
    </div> 
    <div class="navbar animated fadeInDown">
        <div class="motto">
            <h2></h2>
        </div>

</header>



    
<div class="nav index" style="height: 60px;">
    <div class="title animated fadeInDown">
        <div class="layui-container"> 
        
            <div class="nav-logo"> <a href="https://www.taraxacum.ink" title="ä¸€æ—¶å¼€æºä¸€æ—¶çˆ½ï¼Œä¸€ç›´å¼€æºä¸€ç›´çˆ½"><i class="fab fa-github" style="font-size: 36px;"></i></a> </div>
         
        <div class="nav-list">
            <button> <span class=""></span><span style="display: block;"></span><span class=""></span> </button>
            <ul class="layui-nav" lay-filter="">
            
            <li class="layui-nav-item">
                <a href="/blog/">
                    <i class="fab fa-fort-awesome" aria-hidden="true"></i>
                    é¦–é¡µ
                </a>
            </li>
            
            <li class="layui-nav-item">
                <a href="/blog/archives/">
                    <i class="far fa-calendar-check" aria-hidden="true"></i>
                    å½’æ¡£
                </a>
            </li>
            
            <li class="layui-nav-item">
                <a href="/blog/tags/">
                    <i class="fas fa-hashtag" aria-hidden="true"></i>
                    æ ‡ç­¾
                </a>
            </li>
            
            <li class="layui-nav-item">
                <a href="/blog/about/">
                    <i class="fab fa-grav" aria-hidden="true"></i>
                    å…³äº
                </a>
            </li>
            
            <li class="layui-nav-item">
                <a href="/blog/guestbook/">
                    <i class="fab fa-telegram" aria-hidden="true"></i>
                    ç•™è¨€
                </a>
            </li>
            
            <li class="layui-nav-item">
                <a href="/blog/link/">
                    <i class="fab fa-weixin" aria-hidden="true"></i>
                    å‹é“¾
                </a>
            </li>
            
            <li class="layui-nav-item">
            
                <div id="dark" onclick="switchDarkMode()"></div>   
                <script>
                    if(localStorage.getItem('dark') === '1') {
                        document.body.classList.add('dark');
                    }
                    document.getElementById('dark').innerHTML = document.querySelector("body").classList.contains("dark")?"ğŸŒ™":"ğŸŒ";
                </script>
              
            </li>  
            <span class="layui-nav-bar" style="left: 342px; top: 78px; width: 0px; opacity: 0;"></span>
            </ul>
        </div>
        </div>
    </div>
</div>



    
<article id="post">
  <div class="post-title"><h1>OAuth 2.0</h1></div>
  <div class="post-date">
        <span title="å‘è¡¨äº 2020-07-26"><i class="far fa-calendar-alt" aria-hidden="true"></i> 2020-07-26</span>  |  
        <span title="æ›´æ–°äº 2020-07-26"><i class="fas fa-history" aria-hidden="true"></i> 2020-07-26</span>
        
  </div>
  <br>
  <div class="content">
      <div><div class="note note-info">
            <p>å‚è€ƒèµ„æ–™ï¼š</p><ul><li>The OAuth 2.0 Authorization Framework<br>  <a href="http://www.rfcreader.com/#rfc6749" target="_blank" rel="noopener">http://www.rfcreader.com/#rfc6749</a><br>  æ–‡ä¸­æ‰€æœ‰è‹±æ–‡æè¿°ï¼ˆé™¤ç‰¹åˆ«æ³¨æ˜å¤–ï¼‰å‡å¼•è‡ªè¯¥æ–‡æ¡£ã€‚</li></ul>
          </div>


<h2 id="THEORY"><a href="#THEORY" class="headerlink" title="THEORY"></a>THEORY</h2><p>åœ¨ä¼ ç»Ÿçš„Client-Serverè®¤è¯æ¨¡å‹ä¸­ï¼Œå®¢æˆ·ç«¯ï¼ˆClientï¼‰å‘æœåŠ¡å™¨ï¼ˆServerï¼‰è¯·æ±‚å—ä¿æŠ¤çš„èµ„æºæ—¶ï¼Œéœ€è¦æä¾›èµ„æºæ‰€æœ‰è€…ï¼ˆResource Ownerï¼‰çš„ç”¨æˆ·åå’Œå£ä»¤ï¼ˆå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„å¯†ç ï¼›ä¹Ÿå¯èƒ½æ˜¯å…¶ä»–çš„credentialsï¼Œé€šå¸¸æ˜¯å£ä»¤ï¼‰ã€‚</p>
<pre><code class="mermaid">sequenceDiagram
    participant RO as å°æ˜&lt;br/&gt;(Resource Owner)
    participant C  as æ•™åŠ¡ç½‘ç«™&lt;br/&gt;(Client)
    participant RS as æ•™åŠ¡æœåŠ¡å™¨&lt;br/&gt;(Resource Server)

    RO -&gt;&gt; C : æˆ‘æ˜¯å°æ˜ï¼Œå¸®æˆ‘æŸ¥ä¸€ä¸‹æˆç»©
    C  -&gt;&gt; RO: è¯æ˜ä¸€ä¸‹ä½ æ˜¯å°æ˜
    RO -&gt;&gt; C : è¿™æ˜¯æˆ‘çš„å£ä»¤
    C  -&gt;&gt; RS: å°æ˜è¦æŸ¥æˆç»©ï¼Œè¿™æ˜¯ä»–çš„å£ä»¤
    RS -&gt;&gt; C : è®¤è¯é€šè¿‡ï¼Œè¿™æ˜¯å°æ˜çš„æˆç»©
    C  -&gt;&gt; RO: å°æ˜ï¼Œè¿™æ˜¯ä½ çš„æˆç»©</code></pre>
<p>å½“éœ€è¦ç¬¬ä¸‰æ–¹æœåŠ¡è®¿é—®å—ä¿æŠ¤çš„èµ„æºæ—¶ï¼Œèµ„æºæ‰€æœ‰è€…åˆ™éœ€è¦å°†ç”¨æˆ·åå’Œå£ä»¤æä¾›ç»™ç¬¬ä¸‰æ–¹æœåŠ¡ã€‚</p>
<pre><code class="mermaid">sequenceDiagram
    participant RO as å°æ˜&lt;br/&gt;(Resource Owner)
    participant C  as ç¬¬ä¸‰æ–¹ç½‘ç«™&lt;br/&gt;(Client)
    participant TP as ç¬¬ä¸‰æ–¹æœåŠ¡å™¨&lt;br/&gt;(Third-party Application)
    participant RS as æ•™åŠ¡æœåŠ¡å™¨&lt;br/&gt;(Resource Server)

    RO -&gt;&gt; C : æˆ‘æ˜¯å°æ˜&lt;br/&gt;å¸®æˆ‘ç®—ä¸€ä¸‹GPA
    C  -&gt;&gt; RO: è¯æ˜ä¸€ä¸‹ä½ æ˜¯å°æ˜
    RO -&gt;&gt; C : è¿™æ˜¯æˆ‘çš„å£ä»¤
    C  -&gt;&gt; TP: å°æ˜è¦ç®—GPA&lt;br/&gt;è¿™æ˜¯ä»–çš„å£ä»¤
    TP -&gt;&gt; RS: æˆ‘è¦æŸ¥å°æ˜çš„æˆç»©&lt;br/&gt;è¿™æ˜¯å°æ˜çš„å£ä»¤
    RS -&gt;&gt; TP: è®¤è¯é€šè¿‡ï¼Œè¿™æ˜¯å°æ˜çš„æˆç»©
    TP -&gt;&gt; C : è¿™æ˜¯å°æ˜çš„GPA
    C  -&gt;&gt; RO: å°æ˜ï¼Œè¿™æ˜¯ä½ çš„GPA</code></pre>
<p>è¿™æ ·çš„è®¤è¯æ¨¡å¼å­˜åœ¨ä¸€äº›å®‰å…¨æ€§é—®é¢˜ï¼š</p>
<ul>
<li>èµ„æºæœåŠ¡å™¨éœ€è¦æ”¯æŒåŸºäºå£ä»¤çš„èº«ä»½è®¤è¯</li>
<li>èµ„æºæ‰€æœ‰è€…éœ€è¦åœ¨ä»¥ä¸‹æ–¹é¢è¶³å¤Ÿä¿¡ä»»ç¬¬ä¸‰æ–¹åº”ç”¨<ul>
<li>ç¬¬ä¸‰æ–¹åº”ç”¨ä¸ä¼šå­˜å‚¨è‡ªå·±çš„å£ä»¤ï¼Œæˆ–è€…</li>
<li>ç¬¬ä¸‰æ–¹åº”ç”¨ä¼šå­˜å‚¨è‡ªå·±çš„æ˜æ–‡å£ä»¤ä»¥å¤‡å°†æ¥ä½¿ç”¨ï¼Œä½†æ˜¯<ul>
<li>ç¬¬ä¸‰æ–¹åº”ç”¨ä¸ä¼šåœ¨æœªç»æˆæƒçš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨å£ä»¤è·å–ä¿¡æ¯ï¼ˆæ¯”å¦‚æŸ¥è¯¢å°æ˜çš„è”ç³»ç”µè¯ï¼‰æˆ–è€…è¿›è¡Œå…¶ä»–æ´»åŠ¨ï¼ˆæ¯”å¦‚ç»™å°æ˜é€€è¯¾ï¼‰</li>
<li>ç¬¬ä¸‰æ–¹åº”ç”¨è¶³å¤Ÿå®‰å…¨ï¼ˆå¦‚æœæ”»å‡»è€…å¾—åˆ°äº†è¯¥åº”ç”¨çš„æ•°æ®åº“ï¼Œå¯èƒ½å¯¼è‡´å°æ˜çš„å£ä»¤è¢«æ³„éœ²ç»™æ”»å‡»è€…ï¼‰</li>
</ul>
</li>
</ul>
</li>
<li>èµ„æºæ‰€æœ‰è€…åªæœ‰é€šè¿‡æ›´æ”¹å£ä»¤æ‰èƒ½æ’¤é”€å¯¹ç¬¬ä¸‰æ–¹åº”ç”¨çš„æˆæƒï¼Œä¸”å½“æ›´æ”¹å£ä»¤æ—¶æ‰€æœ‰çš„ç¬¬ä¸‰æ–¹åº”ç”¨å°†åŒæ—¶å¤±æ•ˆï¼Œæ— æ³•æœ‰é’ˆå¯¹æ€§åœ°æ’¤é”€å¯¹æŸä¸€ä¸ªåº”ç”¨çš„æˆæƒã€‚</li>
</ul>
<p>æ‰€ä»¥æˆ‘ä»¬å¼•å…¥<strong>è®¿é—®ä»¤ç‰Œ</strong>ï¼ˆAccess Tokenï¼‰ã€‚ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯å¯ä»¥è·å¾—ä¸€ä¸ªè®¿é—®ä»¤ç‰Œï¼ˆAccess Tokenï¼‰ï¼Œä»¤ç‰Œä¸Šé™„æœ‰ä½¿ç”¨è¯¥ä»¤ç‰Œå¯ä»¥åœ¨å¤šé•¿æ—¶é—´èŒƒå›´å†…è®¿é—®å“ªäº›èµ„æºç­‰ä¿¡æ¯ã€‚ä½¿ç”¨è¯¥è®¿é—®ä»¤ç‰Œå¯ä»¥å‘èµ„æºæœåŠ¡å™¨è¯·æ±‚å—ä¿æŠ¤çš„èµ„æºã€‚</p>
<pre><code class="mermaid">sequenceDiagram
    participant RO as å°æ˜&lt;br/&gt;(Resource Owner)
    participant AS as æˆæƒæœåŠ¡å™¨&lt;br/&gt;(Authorization Server)
    participant C  as ç¬¬ä¸‰æ–¹ç½‘ç«™&lt;br/&gt;(Client)
    participant TP as ç¬¬ä¸‰æ–¹æœåŠ¡å™¨&lt;br/&gt;(Third-party Application)
    participant RS as æ•™åŠ¡æœåŠ¡å™¨&lt;br/&gt;(Resource Server)

    RO -&gt;&gt; AS: æˆ‘æ˜¯å°æ˜&lt;br/&gt;æˆ‘è¦æˆæƒåˆ«äººæŸ¥è¯¢æˆ‘çš„æˆç»©
    AS -&gt;&gt; RO: è¯æ˜ä¸€ä¸‹ä½ æ˜¯å°æ˜
    RO -&gt;&gt; AS: è¿™æ˜¯æˆ‘çš„å£ä»¤
    AS -&gt;&gt; RO: è¿™æ˜¯ä½ è¦çš„ä»¤ç‰Œ
    note over AS,RO: ä½¿ç”¨è¯¥ä»¤ç‰Œå¯ä»¥åœ¨ä¸€å¤©å†…æŸ¥è¯¢å°æ˜çš„æˆç»©

    RO -&gt;&gt; C : æˆ‘æ˜¯å°æ˜&lt;br/&gt;å¸®æˆ‘ç®—ä¸€ä¸‹GPA
    C  -&gt;&gt; RO: è¯æ˜ä¸€ä¸‹ä½ æ˜¯å°æ˜
    RO -&gt;&gt; C : è¿™æ˜¯æˆ‘çš„è®¿é—®ä»¤ç‰Œ
    C  -&gt;&gt; TP: å°æ˜è¦ç®—GPA&lt;br/&gt;è¿™æ˜¯ä»–çš„è®¿é—®ä»¤ç‰Œ
    TP -&gt;&gt; RS: æˆ‘è¦æŸ¥å°æ˜çš„æˆç»©&lt;br/&gt;è¿™æ˜¯å°æ˜çš„è®¿é—®ä»¤ç‰Œ
    RS -&gt;&gt; TP: è®¤è¯é€šè¿‡ï¼Œè¿™æ˜¯å°æ˜çš„æˆç»©
    TP -&gt;&gt; C : è¿™æ˜¯å°æ˜çš„GPA
    C  -&gt;&gt; RO: å°æ˜ï¼Œè¿™æ˜¯ä½ çš„GPA</code></pre>
<p>ä¾‹å¦‚ï¼Œåœ¨Githubä¸­å°±æœ‰<a href="https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token" target="_blank" rel="noopener">Personal Access Token</a>å°±æä¾›äº†ç±»ä¼¼äºè¿™ç§æ¨¡å¼çš„è®¤è¯ã€‚</p>
<h3 id="OAuth-ä¸­çš„è§’è‰²"><a href="#OAuth-ä¸­çš„è§’è‰²" class="headerlink" title="OAuth ä¸­çš„è§’è‰²"></a>OAuth ä¸­çš„è§’è‰²</h3><ul>
<li><strong>èµ„æºæ‰€æœ‰è€…</strong>ï¼ˆresource ownerï¼‰<br>An entity capable of granting access to a protected resource.  When the resource owner is a person, it is referred to as an end-user.</li>
<li><strong>èµ„æºæœåŠ¡å™¨</strong>ï¼ˆresource serverï¼‰<br>The server hosting the protected resources, capable of accepting and responding to protected resource requests using access tokens.</li>
<li><strong>å®¢æˆ·ç«¯</strong>ï¼ˆclientï¼‰<br>An application making protected resource requests on behalf of the resource owner and with its authorization.  The term â€œclientâ€ does not imply any particular implementation characteristics (e.g., whether the application executes on a server, a desktop, or other devices).</li>
<li><strong>è®¤è¯æœåŠ¡å™¨</strong>ï¼ˆauthorization serverï¼‰<br>The server issuing access tokens to the client after successfully authenticating the resource owner and obtaining authorization.</li>
</ul>
<!-- The interaction between the authorization server and resource server is beyond the scope of this specification. -->
<!-- The authorization server may be the same server as the resource server or a separate entity. A single authorization server may issue access tokens accepted by multiple resource servers. -->

<h3 id="OAuth-æŠ½è±¡åè®®æµç¨‹"><a href="#OAuth-æŠ½è±¡åè®®æµç¨‹" class="headerlink" title="OAuth æŠ½è±¡åè®®æµç¨‹"></a>OAuth æŠ½è±¡åè®®æµç¨‹</h3><pre><code class="mermaid">sequenceDiagram
    participant RO as Resource Owner
    participant C  as Client
    participant AS as Authorization Server
    participant RS as Resource Server


    C -&gt;&gt; RO: 1. Authorization Request
    RO -&gt;&gt; C: 2. Authorization Grant

    C -&gt;&gt; AS: 3. Authorization Grant
    AS -&gt;&gt; C: 4. Access Token

    C -&gt;&gt; RS: 5. Access Token
    RS -&gt;&gt; C: 6. Protected Resource</code></pre>
<ol>
<li>å®¢æˆ·ç«¯å‘èµ„æºæ‰€æœ‰è€…è¯·æ±‚æˆæƒã€‚å¯ä»¥ç›´æ¥å‘èµ„æºæ‰€æœ‰è€…æå‡ºæˆæƒè¯·æ±‚ï¼ˆå¦‚å›¾æ‰€ç¤ºï¼‰ï¼Œæˆ–è€…æœ€å¥½é€šè¿‡æˆæƒæœåŠ¡å™¨ä½œä¸ºä¸­ä»‹é—´æ¥è¿›è¡Œæˆæƒã€‚</li>
<li>å®¢æˆ·ç«¯æ”¶åˆ°æˆæƒè®¸å¯ã€‚æˆæƒè®¸å¯æ˜¯è¡¨ç¤ºèµ„æºæ‰€æœ‰è€…æˆæƒçš„å‡­æ®ï¼Œè¿™ä¸ªå‡­æ®æœ‰å„ç§ä¸åŒçš„è¡¨ç¤ºå½¢å¼ã€‚ä½¿ç”¨å“ªç§å½¢å¼æˆæƒå–å†³äºå®¢æˆ·ç«¯è¯·æ±‚æˆæƒæ‰€ä½¿ç”¨çš„æ–¹æ³•ä»¥åŠæˆæƒæœåŠ¡å™¨æ”¯æŒçš„ç±»å‹ã€‚</li>
<li>å®¢æˆ·ç«¯é€šè¿‡ä¸æˆæƒæœåŠ¡å™¨è¿›è¡Œèº«ä»½è®¤è¯ï¼ˆéªŒè¯å®¢æˆ·ç«¯çš„èº«ä»½ï¼‰å¹¶æä¾›å‡­æ®ï¼ˆè¯æ˜å·²ç»å¾—åˆ°èµ„æºæ‰€æœ‰è€…çš„æˆæƒè®¸å¯ï¼‰æ¥è¯·æ±‚è®¿é—®ä»¤ç‰Œã€‚</li>
<li>æˆæƒæœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯è¿›è¡Œèº«ä»½è®¤è¯ï¼Œå¹¶ä¸”éªŒè¯æˆæƒè®¸å¯ã€‚å¦‚æœæˆæƒè®¸å¯æ˜¯æœ‰æ•ˆçš„ï¼Œåˆ™ç»™å®¢æˆ·ç«¯å‘æ”¾å¯¹åº”çš„è®¿é—®ä»¤ç‰Œã€‚</li>
<li>å®¢æˆ·ç«¯å‘èµ„æºæœåŠ¡å™¨å‡ºç¤ºè®¿é—®ä»¤ç‰Œï¼Œè¯·æ±‚è·å–å—ä¿æŠ¤çš„èµ„æº</li>
<li>èµ„æºæœåŠ¡å™¨éªŒè¯è®¿é—®ä»¤ç‰Œã€‚å¦‚æœè®¿é—®ä»¤ç‰Œæ˜¯æœ‰æ•ˆçš„ï¼Œåˆ™æä¾›è¦æ±‚çš„æœåŠ¡ã€‚</li>
</ol>
<div class="note note-info">
            <p>åŒºåˆ†è®¤è¯ï¼ˆAuthenticationï¼‰å’Œæˆæƒï¼ˆAuthorizationï¼‰</p><p>è®¤è¯æ˜¯ç¡®è®¤ä¸€ä¸ªå®ä½“çš„èº«ä»½çš„è¿‡ç¨‹ï¼Œæˆæƒæ˜¯ç¡®è®¤è¯¥å®ä½“èƒ½åšå‡ºçš„åŠ¨ä½œçš„è¿‡ç¨‹ã€‚ä»¥ç–«æƒ…æœŸé—´è¿›å…¥å­¦æ ¡ä¸ºä¾‹ã€‚æŸ¥éªŒä¸€ä¸ªäººçš„å­¦ç”Ÿè¯å¹¶æ¯”å¯¹ç…§ç‰‡çš„è¿‡ç¨‹æ˜¯ä¸ºäº†ç¡®è®¤è¿™ä¸ªäººæ˜¯å­¦ç”Ÿï¼ˆè®¤è¯ï¼‰ï¼ŒæŸ¥éªŒä»–çš„çŸ­ä¿¡å’Œäº¤æˆ‘åŠä¸Šçš„å…¥æ ¡è®¸å¯æ˜¯ä¸ºäº†ç¡®è®¤è¿™ä¸ªå­¦ç”Ÿæœ‰è¿›å…¥å­¦æ ¡çš„æƒé™ï¼ˆæˆæƒï¼‰ã€‚</p><p>OAuthåšçš„æ˜¯Authorizationï¼ŒOpenIDåšçš„æ˜¯Authenticationã€‚</p>
          </div>

<h2 id="Practice"><a href="#Practice" class="headerlink" title="Practice"></a>Practice</h2><h3 id="ä»¥i-sjtu-edu-cnä¸ºä¾‹è§‚å¯ŸjAccountçš„è®¤è¯å’Œæˆæƒæµç¨‹"><a href="#ä»¥i-sjtu-edu-cnä¸ºä¾‹è§‚å¯ŸjAccountçš„è®¤è¯å’Œæˆæƒæµç¨‹" class="headerlink" title="ä»¥i.sjtu.edu.cnä¸ºä¾‹è§‚å¯ŸjAccountçš„è®¤è¯å’Œæˆæƒæµç¨‹"></a>ä»¥i.sjtu.edu.cnä¸ºä¾‹è§‚å¯ŸjAccountçš„è®¤è¯å’Œæˆæƒæµç¨‹</h3><p>ä»é¦–é¡µä¸Šè·å–jAccountè®¤è¯çš„å…¥å£</p>
<img src="/blog/posts/Theory-and-Practice/20200726-2fb7319c/jaccountlogin.png" class="">

<p>å…¶é“¾æ¥ä¸º <a href="https://i.sjtu.edu.cn/jaccountlogin" target="_blank" rel="noopener">https://i.sjtu.edu.cn/jaccountlogin</a> ï¼Œç‚¹å‡»è¯¥é“¾æ¥å¯ä»¥çœ‹åˆ°é¡µé¢è·³è½¬åˆ°äº† jaccount.sjtu.edu.cn ä¸‹çš„èº«ä»½è®¤è¯é¡µé¢ã€‚åˆ©ç”¨PythonæŸ¥è¯¢è·³è½¬å†å²ã€‚</p>
<pre><code class="python">import httpx

entry_point = &#39;https://i.sjtu.edu.cn/jaccountlogin&#39;

with httpx.Client() as client:
    resp = client.get(entry_point)
    for r in resp.history:
        print(r.url)

    print(resp.url)
</code></pre>
<pre><code>https://i.sjtu.edu.cn/jaccountlogin
https://jaccount.sjtu.edu.cn/oauth2/authorize?scope=essential&amp;response_type=code&amp;redirect_uri=http%3A%2F%2Fi.sjtu.edu.cn%2Fjaccountlogin&amp;client_id=MVJGw8u0bzoMJVbfb4Fk
https://jaccount.sjtu.edu.cn/jaccount/jalogin?sid=jaoauth220160718&amp;client=CLaY6dLZ1oTGA7PeX6O0ZvkydDeYeCh1W8y6fOzYSy5F&amp;returl=CMG1Z60lChyMcBee8%2Bp5qk8qRGTnGRvnVdaTVz6u0E%2FtqVHWOxmZG4y7SqGJQfRy2mmBzse%2FZ1ymtO67lTUhHGJr4VCJEpE28Fap016tcphY4X1zIhVRfEejfyGIoJ%2BZBQ%3D%3D&amp;se=CJSNLdgVZ8TOpAl7Utu3Qqu0qSkPZ0qNdLPqIjGhEntjPz9fIVo8Jt4WS23Nrte5zA%3D%3D</code></pre><p>å¯ä»¥çœ‹åˆ°é¡µé¢é¦–å…ˆé‡å®šå‘åˆ°äº†<code>https://jaccount.sjtu.edu.cn/oauth2/authorize</code>è¯·æ±‚æˆæƒï¼Œåœ¨æˆæƒè¿‡ç¨‹ä¸­é€šè¿‡é¡µé¢<code>https://jaccount.sjtu.edu.cn/jaccount/jalogin</code>å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½è®¤è¯ï¼ˆè¦æ±‚ç”¨æˆ·æäº¤ç”¨æˆ·åå’Œå¯†ç ï¼‰ã€‚</p>
<h4 id="Authorize"><a href="#Authorize" class="headerlink" title="Authorize"></a>Authorize</h4><p>å…¶ä¸­<code>/oauth2/authorize</code>çš„è¯·æ±‚å‚æ•°å¦‚ä¸‹ï¼š</p>
<pre><code class="json">{
    &quot;scope&quot;: &quot;essential&quot;,
    &quot;response_type&quot;: &quot;code&quot;,
    &quot;redirect_uri&quot;: &quot;http://i.sjtu.edu.cn/jaccountlogin&quot;,
    &quot;client_id&quot;: &quot;MVJGw8u0bzoMJVbfb4Fk&quot;
}</code></pre>
<p><a href="https://tools.ietf.org/html/rfc6749#section-3.1.1" target="_blank" rel="noopener"><code>response_type</code></a>é”®æŒ‡å®šäº†æˆæƒçš„å½¢å¼ã€‚å…¶å€¼ä¸º<code>code</code>è¡¨æ˜æˆæƒå½¢å¼ä¸º<a href="https://tools.ietf.org/html/rfc6749#section-4.1" target="_blank" rel="noopener">Authorization Code</a>ã€‚</p>
<p><a href="https://tools.ietf.org/html/rfc6749#section-2.2" target="_blank" rel="noopener"><code>client_id</code></a>é”®æŒ‡å®šäº†è¯·æ±‚jAccountæˆæƒçš„å®¢æˆ·ç«¯IDã€‚</p>
<p><a href="https://tools.ietf.org/html/rfc6749#section-3.1.2" target="_blank" rel="noopener"><code>redirect_uri</code></a>é”®æŒ‡å®šäº†æˆæƒæˆåŠŸåçš„è·³è½¬é“¾æ¥ã€‚</p>
<p><a href="https://tools.ietf.org/html/rfc6749#section-3.3" target="_blank" rel="noopener"><code>scope</code></a>é”®æŒ‡å®šäº†æˆæƒèŒƒå›´ã€‚åœ¨<a href="http://developer.sjtu.edu.cn/wiki/APIs#API_Scopes" target="_blank" rel="noopener">å¼€å‘æ–‡æ¡£</a>ä¸­å¯ä»¥çœ‹åˆ°ï¼Œessentialä½¿æ•™åŠ¡å¤„èƒ½è¯»å–ç”¨æˆ·çš„åŸºæœ¬æ ‡è¯†å’Œå§“åï¼Œä»¥åŠå¸å·ç»‘å®šçš„èº«ä»½çš„ä¿¡æ¯ï¼ˆåŒ…æ‹¬èº«ä»½idï¼Œèº«ä»½ç±»å‹å’Œèº«ä»½æ‰€å±éƒ¨é—¨é™¢ç³»ï¼‰ã€‚å…·ä½“åŒ…æ‹¬ä»¥ä¸‹å†…å®¹</p>
<pre><code class="json">{
  &quot;id&quot;:{guid},                      // æ— æ„ä¹‰çš„å”¯ä¸€id
  &quot;account&quot;:{string},               // jaccount, å¸å·å
  &quot;name&quot;:{string},                  // çœŸå®å§“å
  &quot;kind&quot;:&quot;canvas.profile&quot;,
  &quot;code&quot;:{string},                  // é»˜è®¤èº«ä»½å­¦/å·¥å·
  &quot;userType&quot;: {string},             // é»˜è®¤èº«ä»½ç”¨æˆ·ç±»å‹ï¼ŒåŒæ­¥è‡ªç»Ÿä¸€æˆæƒï¼Œä¸»è¦åŒ…æ‹¬ï¼šfaculty, student
  &quot;organize&quot;:{                      // é»˜è®¤èº«ä»½æ‰€å±æœºæ„
    &quot;id&quot;:{string},
    &quot;name&quot;:{string}                 // ç»„ç»‡æœºæ„å
  },
  &quot;timeZone&quot;: {int},                // ç”¨æˆ·æ‰€åœ¨æ—¶åŒºï¼Œé»˜è®¤+8
  &quot;identities&quot;:[nicman.identity]    // å¸å·ç»‘å®šèº«ä»½ä¿¡æ¯,
}</code></pre>
<h4 id="Authenticate"><a href="#Authenticate" class="headerlink" title="Authenticate"></a>Authenticate</h4><p>æ¨¡æ‹Ÿå¡«å†™è¡¨å•è¿›è¡ŒjAccountç™»å½•</p>
<pre><code class="python">import json
from io import BytesIO
from time import time
from urllib.parse import parse_qsl, urlparse

import httpx
from bs4 import BeautifulSoup
from PIL import Image

entry_point = &#39;https://i.sjtu.edu.cn/jaccountlogin&#39;

with httpx.Client() as client:
    resp = client.get(entry_point)

    url_ql = dict(parse_qsl(resp.url.query))

    soup = BeautifulSoup(resp.content, &#39;html.parser&#39;)

    form = dict([
        (e.get(&#39;name&#39;), e.get(&#39;value&#39;))
        for e in soup.find(&#39;form&#39;, id=&#39;form-input&#39;).find_all(&#39;input&#39;)
        if e.get(&#39;type&#39;) != &#39;submit&#39;
    ])

    captcha_resp = client.get(resp.url.join(f&#39;captcha?&#39;), params={
        &#39;uuid&#39;: form[&quot;uuid&quot;],
        &#39;t&#39;: int(time()*1000)
    })
    captcha_fp = BytesIO(captcha_resp.content)
    captcha_img = Image.open(captcha_fp).convert(&#39;L&#39;)
    width, height = captcha_img.size
    for y in range(0, height):
        for x in range(0, width):
            pixel = captcha_img.getpixel((x, y))
            if pixel &gt; 225:
                print(&#39; &#39;, end=&#39;&#39;)
            else:
                print(&#39;*&#39;, end=&#39;&#39;)
        print(&#39;&#39;)

    form[&#39;user&#39;] = input(&#39;Input your username: &#39;).strip()
    form[&#39;pass&#39;] = input(&#39;Input your password: &#39;).strip()
    form[&#39;captcha&#39;] = input(&#39;Input the Captcha: &#39;).strip()

    auth_resp = httpx.post(
        &#39;https://jaccount.sjtu.edu.cn/jaccount/ulogin&#39;, data=form)

    if auth_resp.url.host == &#39;jaccount.sjtu.edu.cn&#39;:
        if &#39;err&#39; in dict(parse_qsl(auth_resp.url.query)):
            soup = BeautifulSoup(auth_resp.content, &#39;html.parser&#39;)
            msg = soup.find(&#39;div&#39;, id=&#39;div_warn&#39;).text
            print(msg)
        else:
            print(&#39;Unknown error&#39;)
    else:
        for r in auth_resp.history.copy() + [auth_resp]:
            print(r.request.method, r.status_code, r.url, sep=&#39;\t&#39;)</code></pre>
<p>ç”±äºå¯èƒ½æ¶‰åŠåˆ°éšç§ä¿¡æ¯ï¼Œå°±ä¸è´´å‡ºè¿è¡Œç»“æœäº†ã€‚å¯ä»¥ä»è¾“å‡ºä¸­çœ‹åˆ°åœ¨<code>jaccount.sjtu.edu.cn</code>ç»è¿‡ä¸€ç³»åˆ—è·³è½¬åï¼Œæœ€ç»ˆè®¿é—®äº†ä¹‹å‰è®¾å®šçš„è¿”å›åœ°å€ï¼Œå¹¶ä¸”åŠ ä¸Šäº†æˆæƒç <code>code</code>å‚æ•°ã€‚</p>
<div class="note note-info">
            <p>æ³¨ï¼šæ­¤å¤„åº”è¯¥è¿˜æœ‰ä¸€ä¸ªwebé¡µé¢ï¼Œéœ€è¦ç”¨æˆ·æ˜¾å¼åŒæ„æˆæƒ<code>i.sjtu.edu.cn</code>è®¿é—®ç”¨æˆ·çš„essentialä¿¡æ¯ï¼Œä½†æ˜¯å› ä¸ºæˆ‘å·²ç»æˆæƒè¿‡äº†ï¼ˆå¹¶ä¸”æˆ‘æ‰¾ä¸åˆ°åœ¨å“ªé‡Œå–æ¶ˆæˆæƒï¼‰æ‰€ä»¥è¿™é‡Œå°±ä¸ä¼šå†æç¤ºæˆæƒã€‚</p>
          </div>


<pre><code>http://i.sjtu.edu.cn/jaccountlogin?code={Authorization Code}</code></pre><p><code>i.sjtu.edu.cn</code>å°±å¯ä»¥ä½¿ç”¨è¿™ä¸€æˆæƒç è·å–essentialä¿¡æ¯ã€‚</p>
<h3 id="åŸºäºPassport-jsæ­å»ºä¸€ä¸ª-OAuth2-æœåŠ¡"><a href="#åŸºäºPassport-jsæ­å»ºä¸€ä¸ª-OAuth2-æœåŠ¡" class="headerlink" title="åŸºäºPassport.jsæ­å»ºä¸€ä¸ª OAuth2 æœåŠ¡"></a>åŸºäºPassport.jsæ­å»ºä¸€ä¸ª OAuth2 æœåŠ¡</h3><p>æ–°å»ºä¸€ä¸ªåŸºäºExpress.jsçš„webé¡¹ç›®</p>
<p><a href="https://expressjs.com/en/starter/generator.html" target="_blank" rel="noopener">https://expressjs.com/en/starter/generator.html</a></p>
<p>å®‰è£…Passport.js</p>
<p><a href="http://www.passportjs.org/docs/" target="_blank" rel="noopener">http://www.passportjs.org/docs/</a></p>
<pre><code class="shell">$ npm install passport</code></pre>
<h4 id="ç”¨æˆ·åã€å¯†ç è®¤è¯"><a href="#ç”¨æˆ·åã€å¯†ç è®¤è¯" class="headerlink" title="ç”¨æˆ·åã€å¯†ç è®¤è¯"></a>ç”¨æˆ·åã€å¯†ç è®¤è¯</h4><p>å®‰è£…è®¤è¯æ¨¡å—</p>
<pre><code class="shell">$ npm install passport-local</code></pre>
<p>åœ¨<code>app.js</code>ä¸­å¼•å…¥passport</p>
<pre><code class="javascript">var passport = require(&#39;passport&#39;);

app.use(passport.initialize());
app.use(passport.session());</code></pre>
<p>ä¸ºäº†å¥½çœ‹ä¸€ç‚¹å„¿ï¼Œåœ¨<code>layout.jade</code>é‡ŒåŠ ä¸€ä¸ªBootstrap</p>
<pre><code class="jade">doctype html
html
  head
    meta(charset=&quot;utf-8&quot;)
    meta(name=&quot;viewport&quot;, content=&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;)
    title= title
    link(rel=&quot;stylesheet&quot;, href=&quot;https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css&quot;)
    link(rel=&#39;stylesheet&#39;, href=&#39;/stylesheets/style.css&#39;)
  body
    block content</code></pre>
<p>è®¾è®¡ç™»å½•è§†å›¾<code>login.jade</code></p>
<pre><code class="jade">extends layout

block content
    .container
        form(action=&quot;/users/login&quot;, method=&quot;post&quot;)
            div.form-group
                label(for=&quot;username&quot;) Username:
                input#username.form-control(type=&quot;text&quot;, name=&quot;username&quot;)
            div.form-group
                label(for=&quot;password&quot;) Password:
                input#password.form-control(type=&quot;password&quot;, name=&quot;password&quot;)
            div
                input#submit.btn.btn-primary(type=&quot;submit&quot;, name=&quot;submit&quot;)</code></pre>
<p>å’Œç™»å½•æˆåŠŸåçš„é¡µé¢<code>hello.jade</code></p>
<pre><code class="jade">extends layout

block content
  h1= title
  h2 Hello, #{username}</code></pre>
<p>åœ¨ <code>routes/users.js</code> ä¸­å¼•å…¥passportå’ŒLocalStrategy</p>
<pre><code class="javascript">var passport = require(&#39;passport&#39;)
  , LocalStrategy = require(&#39;passport-local&#39;).Strategy;</code></pre>
<p>ç”±äºè¿™é‡Œæ˜¯ä¸€ä¸ªProof-of-Conceptï¼Œæˆ‘ä»¬å‡è®¾ç”¨æˆ·åå’Œå¯†ç ç›¸ç­‰å³ä¸ºæœ‰æ•ˆã€‚åŒæ—¶è®¾å®šç”¨æˆ·ä¿¡æ¯åœ¨Sessionä¸­åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„è§„åˆ™ã€‚</p>
<pre><code class="javascript">passport.use(new LocalStrategy(
  function (username, password, done) {
    if(username === password) {
      return done(null, username);
    } else {
      return done(null, false, { message: &#39;Incorrect username or password.&#39; });
    }
  }
));

passport.serializeUser(function (user, done) {
  done(null, user.username);
});

passport.deserializeUser(function (username, done) {
  done(null, { username });
});</code></pre>
<p>æ·»åŠ ä¿®æ”¹åŸæœ‰è·¯ç”±å¹¶æ·»åŠ ä¸¤æ¡æ–°çš„è·¯ç”±</p>
<pre><code class="javascript">router.get(&#39;/&#39;, function (req, res, next) {
  if (req.query.user) {
    res.render(&#39;hello&#39;, {
      &#39;title&#39;: &#39;Login Success&#39;,
      &#39;username&#39;: req.query.user
    })
  } else {
    res.send(&#39;respond with a resource&#39;);
  }
});

router.get(&#39;/login&#39;, function (req, res, next) {
  res.render(&#39;login&#39;);
});

router.post(&#39;/login&#39;,
  passport.authenticate(&#39;local&#39;, {
    failureRedirect: &#39;/login&#39;,
    failureFlash: true
  }),
  function (req, res) {
    // If this function gets called, authentication was successful.
    // `req.user` contains the authenticated user.
    res.redirect(&#39;/users?user=&#39; + req.user.username);
  }
);
</code></pre>
<p>è®¿é—®<code>http://localhost:3000/users/login</code>å¡«å†™ç™»å½•è¡¨å•ï¼Œå¦‚æœæˆåŠŸç™»å½•é¡µé¢å°†æ˜¾ç¤ºç”¨æˆ·åã€‚</p>
<p>å½“å‰ä»£ç çš„çŠ¶æ€ä¸º <a href="https://github.com/LuminousXLB/Practice-OAuth-2/tree/local" target="_blank" rel="noopener">https://github.com/LuminousXLB/Practice-OAuth-2/tree/local</a></p>
<h4 id="OAuth-æˆæƒ"><a href="#OAuth-æˆæƒ" class="headerlink" title="OAuth æˆæƒ"></a>OAuth æˆæƒ</h4><p>åœ¨åˆ«å¤„å¯åŠ¨ä¸€ä¸ªOAuthæœåŠ¡å™¨</p>
<pre><code class="shell">$ git clone https://github.com/awais786327/oauth2orize-examples.git
$ cd oauth2orize-examples
$ npm install
$ PORT=4000 npm start</code></pre>
<p>åœ¨è¯¥é¡¹ç›®çš„<code>db/clients.js</code>ä¸­å·²ç»æ³¨å†Œäº†ä¸¤ä¸ªç”¨äºPoCçš„å®¢æˆ·ç«¯</p>
<pre><code class="javascript">const clients = [
  { id: &#39;1&#39;, name: &#39;Samplr&#39;, clientId: &#39;abc123&#39;, clientSecret: &#39;ssh-secret&#39;, isTrusted: false },
  { id: &#39;2&#39;, name: &#39;Samplr2&#39;, clientId: &#39;xyz123&#39;, clientSecret: &#39;ssh-password&#39;, isTrusted: true },
];</code></pre>
<p><code>db/users.js</code>ä¸­å·²ç»æ³¨å†Œäº†ä¸¤ä¸ªç”¨äºPoCçš„ç”¨æˆ·ã€‚</p>
<pre><code class="javascript">const users = [
  { id: &#39;1&#39;, username: &#39;bob&#39;, password: &#39;secret&#39;, name: &#39;Bob Smith&#39; },
  { id: &#39;2&#39;, username: &#39;joe&#39;, password: &#39;password&#39;, name: &#39;Joe Davis&#39; },
];</code></pre>
<p>ä¿®æ”¹æˆ‘ä»¬çš„åº”ç”¨ä»¥ä½¿ç”¨OAuthæˆæƒ</p>
<pre><code class="shell">$ npm install passport-oauth</code></pre>
<p>åœ¨<code>login.jade</code>é‡Œæ·»åŠ ä¸€ä¸ªOAuthç™»å½•çš„æŒ‰é’®ã€‚</p>
<pre><code class="jade">    .container
        div
            a#oauth.btn.btn-primary(href=&quot;/users/login/oauth&quot;) OAuth</code></pre>
<p>åœ¨<code>users.js</code>ä¸­æ·»åŠ OAuthStrategy</p>
<pre><code class="javascript">var OAuthStrategy = require(&#39;passport-oauth&#39;).OAuthStrategy;


passport.use(&#39;provider&#39;, new OAuth2Strategy({
  authorizationURL: &#39;http://localhost:4000/dialog/authorize&#39;,
  tokenURL: &#39;http://localhost:4000/oauth/token&#39;,
  clientID: &#39;abc123&#39;,
  clientSecret: &#39;ssh-secret&#39;,
  callbackURL: &#39;http://localhost:3000/users/login/callback&#39;
},
  function (token, tokenSecret, profile, done) {
    console.log({ token, tokenSecret, profile })
    axios.get(&#39;http://localhost:4000/api/userinfo&#39;, {
      headers: {
        Authorization: `Bearer ${token}`
      }
    }).then((response) =&gt; {
      done(null, {
        username: response.data.name,
        profile: response.data,
        token,
        tokenSecret
      });
    })
  }
));</code></pre>
<p>OAuth2è®¤è¯å…¥å£å’Œå›è°ƒçš„è·¯ç”±</p>
<pre><code class="javascript">// Redirect the user to the OAuth provider for authentication.
router.get(&#39;/login/oauth&#39;, passport.authenticate(&#39;provider&#39;, { scope: &#39;basic&#39; }));

// The OAuth provider has redirected the user back to the application.
// Finish the authentication process by attempting to obtain an access
// token.  If authorization was granted, the user will be logged in.
// Otherwise, authentication has failed.
router.get(&#39;/login/callback&#39;,
  passport.authenticate(&#39;provider&#39;, {
    failureRedirect: &#39;/login&#39;,
    failureFlash: true
  }),
  function (req, res) {
    console.log(req, res)
    // If this function gets called, authentication was successful.
    // `req.user` contains the authenticated user.
    res.redirect(&#39;/users?user=&#39; + req.user.username);
  }
);</code></pre>
<p>ä»£ç è§<code>https://github.com/LuminousXLB/Practice-OAuth-2</code></p>
</div>

      <div class="post-copyright">
      
                <div class="copyright-item">
                    <span> ä½œè€…: Shen Jiamin</span>
                </div>
                <div class="copyright-item">
                    <span> é“¾æ¥: <a href="https://www.taraxacum.ink/blog/posts/Theory-and-Practice/20200726-2fb7319c.html">https://www.taraxacum.ink/blog/posts/Theory-and-Practice/20200726-2fb7319c.html</a></span>
                </div>
                <div class="copyright-item">
                    <span> å£°æ˜: æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨è®¸å¯åè®® <a href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC-BY-NC-4.0</a> è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</span>
                </div>
      
      </div>
</div>
    <div class="tags-back">
      <div class="tags">
        
          <i class="fas fa-tags" aria-hidden="true"></i> <a href="/blog/tags/Security-Protocol/" class="tag">Security Protocol</a>
        
      </div>
      <div class="back">
        <a href="javascript:window.history.back();"><i class="fa fa-reply" aria-hidden="true"></i> back</a>
        <span>Â· </span>
        <a href="/blog/"><i class="fa fa-home" aria-hidden="true"></i> home</a>
      </div>


      <hr>
      <div class="post-nav">
        
        
        <div class="post-nav-next post-nav-item">
            <a href="/blog/posts/Teach-Yourself/20200711-ae6e2ef7.html" >coq 03 - åˆ—è¡¨<i class="fa fa-chevron-right"></i></a>
        </div>
        
      </div>
      <div class="comments">
        <div class="comments">
    
      
      <script src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
      <div id="comment" class="vcomment" ></div>
      <script>
          var notify = 'false' == true ? true : false;
          var verify = 'false' == true ? true : false;
          var GUEST_INFO = ['nick','mail','link'];
          var guest_info = 'nick,mail,link'.split(',').filter(function(item){
              return GUEST_INFO.indexOf(item) > -1
          });
          guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
          window.valine = new Valine({
              el: '.vcomment',
              notify: notify,
              verify: verify,
              appId: "QVuGgnqavTEoyFmGB3ecG7N7-gzGzoHsz",
              appKey: "PqMOedzOXVgiWNfW5IwJfP4j",
              avatar: "mm",
              placeholder: "Just go go",
              guest_info:guest_info,
              pageSize:'10',
              recordIP: 'false',
              serverURLs: "https://qvuggnqa.lc-cn-n1-shared.com",
              emojiCDN: "",
              enableQQ: "true",
          });
      </script>
    
  </div>
      </div>
</article>

    
<a id="gotop" href="javascript:" title="è¿”å›é¡¶éƒ¨"><i class="fa fa-arrow-up" aria-hidden="true"></i></a>
<script>
    window.onscroll = function() {scrollFunction()};
     
    function scrollFunction() {console.log(121);
        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            document.getElementById("gotop").style.display = "block";
        } else {
            document.getElementById("gotop").style.display = "none";
        }
    }
     
    function topFunction() {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
    }
    </script>
    






    
<div id="bottom-outer">
    <div id="bottom-inner">
        Â© 2020 <i class="fa fa-heart" id="heart"></i> Shen Jiamin 
        <br>
        Powered by 
        <a href="http://hexo.io" target="_blank" rel="noopener">hexo</a> | Theme is <a href="https://github.com/a2396837/hexo-theme-blank/" target="_blank" rel="noopener">blank</a>
        
    </div>  
  </div>
<script src="https://www.layuicdn.com/layui-v2.5.6/layui.js"></script>



<script src="/blog/js/script.js"></script>

<script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script>

<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.0.3/build/highlight.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/highlightjs-line-numbers.js@2.7.0/dist/highlightjs-line-numbers.min.js"></script>




<script>
  $("img").not('.page img').not('.nav-logo img').each(function () {
    var element = document.createElement("a");
    $(element).attr("data-fancybox", "gallery");
    $(element).attr("href", $(this).attr("src"));
    $(this).wrap(element);
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script>



<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    }
  };
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js"></script>




<script src="https://cdn.jsdelivr.net/npm/mermaid@8.6.3/dist/mermaid.min.js"></script>
<script>mermaid.initialize({
    startOnLoad: true
  });
</script>


<script>
  var btntop = $('#gotop');
  btntop.on('click', function (e) {
    e.preventDefault();
    $('html, body').animate({ scrollTop: 0 }, '300');
  });
</script>

<script>
  $(document).ready(function () {
    $('pre code').each(function (i, block) {
      if ($.inArray(block.className, ['mermaid']) < 0) {
        hljs.lineNumbersBlock(block);
      }
    });
  });
</script>




</html>